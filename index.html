<!DOCTYPE html>
const exp = document.createElement('div'); exp.className='exp'; exp.innerHTML = '<b>解説：</b>' + (item.e||'');


const nav = document.createElement('div'); nav.className='nav';
const next = document.createElement('button'); next.className='primary'; next.textContent = '次へ'; next.disabled = true;
const back = document.createElement('button'); back.textContent = '戻る'; back.disabled = (idx===0);


next.addEventListener('click',()=>{ idx++; update(); });
back.addEventListener('click',()=>{ if(idx>0){ idx--; update(); } });


nav.appendChild(back); nav.appendChild(next);


card.appendChild(qno); card.appendChild(q); card.appendChild(ul); card.appendChild(exp); card.appendChild(nav);
$quiz.appendChild(card);


function select(choiceIndex, li){
if(answered[qi]) return;
answered[qi] = true;
const lis = ul.querySelectorAll('li');
lis.forEach((el,i)=>{
const isCorrect = correct.includes(i);
if(isCorrect) el.classList.add('correct');
if(i===choiceIndex && !isCorrect) el.classList.add('wrong');
});
const mark = document.createElement('span'); mark.className='rmark';
const ok = correct.includes(choiceIndex);
mark.textContent = ok ? '◯' : '×'; mark.style.color = ok ? 'var(--ok)' : 'var(--err)';
li.prepend(mark);
if(ok){ score++; $score.textContent = score; }
exp.classList.add('show');
next.disabled = false;
}


updateHUD();
}


function updateHUD(){
$progress.textContent = (idx) + ' / ' + qbank.length;
const ratio = (idx / qbank.length) * 100; $bar.style.width = ratio + '%';
}


function update(){ render(); }


document.getElementById('btnShuffle').addEventListener('click',()=>{
order = shuffle(order); idx = 0; score = 0; answered.fill(false); $score.textContent = '0'; update();
});
document.getElementById('btnToggleMode').addEventListener('click',()=>{
modeExam = !modeExam; $modePill.textContent = modeExam ? '試験モード' : '学習モード';
});
document.getElementById('btnRestart').addEventListener('click',()=>{
idx = 0; score = 0; answered.fill(false); $score.textContent='0'; update();
});


update();
})();
</script>
</body>
</html>
